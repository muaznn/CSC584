<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RecycleHub - Schedule Pickup</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="container header-content">
            <a href="user-dashboard.html" class="logo">
                <span>‚ôªÔ∏è</span>
                <span>RecycleHub</span>
            </a>
            <nav>
                <ul id="nav-menu">
                    <!-- Populated by JavaScript -->
                </ul>
            </nav>
            <div class="user-menu">
                <span id="user-display">Guest</span>
                <span id="user-role" class="user-role">Guest</span>
                <button id="logout-btn" class="btn btn-danger" onclick="logout()">Logout</button>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="page-container active">
            <h1 class="page-title">Schedule New Pickup</h1>
            
            <div class="card">
                <form id="pickup-request-form">
                    <div class="form-group">
                        <label class="form-label">Pickup Date & Time</label>
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <input type="date" id="pickup-date" class="form-control" style="flex: 1;" required>
                            <select id="pickup-time" class="form-control" style="flex: 1;" required>
                                <option value="">Select time slot</option>
                                <option value="morning">Morning (8 AM - 12 PM)</option>
                                <option value="afternoon">Afternoon (12 PM - 4 PM)</option>
                                <option value="evening">Evening (4 PM - 7 PM)</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Select Recycling Materials</label>
                        <div class="material-categories">
                            <div class="category-item" onclick="toggleCategory('paper')">
                                <input type="checkbox" id="paper" hidden>
                                <span>üìÑ Paper & Cardboard</span>
                            </div>
                            <div class="category-item" onclick="toggleCategory('plastic')">
                                <input type="checkbox" id="plastic" hidden>
                                <span>üß¥ Plastics</span>
                            </div>
                            <div class="category-item" onclick="toggleCategory('glass')">
                                <input type="checkbox" id="glass" hidden>
                                <span>ü•õ Glass</span>
                            </div>
                            <div class="category-item" onclick="toggleCategory('metal')">
                                <input type="checkbox" id="metal" hidden>
                                <span>ü•´ Metals</span>
                            </div>
                            <div class="category-item" onclick="toggleCategory('electronics')">
                                <input type="checkbox" id="electronics" hidden>
                                <span>üîå Electronics</span>
                            </div>
                        </div>
                    </div>

                    <div id="weight-inputs" style="display: none;">
                        <h3>Estimated Weights (kg)</h3>
                        <!-- Weight inputs will be generated by JavaScript -->
                    </div>

                    <div class="form-group">
                        <label for="special-notes" class="form-label">Special Instructions (Optional)</label>
                        <textarea id="special-notes" class="form-control" rows="3" placeholder="Any special instructions for the collection team..."></textarea>
                    </div>

                    <div style="display: flex; gap: 15px; margin-top: 25px;">
                        <button type="submit" class="btn btn-primary">Submit Request</button>
                        <a href="user-dashboard.html" class="btn">Cancel</a>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="logo" style="font-size: 20px;">
                    <span>‚ôªÔ∏è</span>
                    <span>RecycleHub</span>
                </div>
                <div style="text-align: right;">
                    <p>Community Recycling Collection System</p>
                    <p>Helping communities recycle better</p>
                </div>
            </div>
            <div class="copyright">
                &copy; 2023 RecycleHub. All rights reserved.
            </div>
        </div>
    </footer>

    <script src="app-state.js"></script>
    <script src="request-pickup.js"></script>
    <script>
       document.addEventListener('DOMContentLoaded', function() {
        // Check if user is logged in
        const savedUser = localStorage.getItem('recycleHubUser');
        if (!savedUser || JSON.parse(savedUser).role !== 'user') {
            window.location.href = 'login.html';
            return;
        }

        // Initialize app state
        appState.currentUser = JSON.parse(savedUser);
        appState.isLoggedIn = true;
        appState.userRole = 'user';

        // Update navigation and user display
        updateNavigation();
        updateUserDisplay();

        // Set minimum date to today
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('pickup-date').min = today;

        // Form submission
        document.getElementById('pickup-request-form').addEventListener('submit', function(e) {
            e.preventDefault();
            submitPickupRequest();
        });
    });

    function toggleCategory(material) {
        const checkbox = document.getElementById(material);
        const categoryItem = checkbox.parentElement;

        checkbox.checked = !checkbox.checked;
        categoryItem.classList.toggle('selected');

        // Show/hide weight input
        if (checkbox.checked) {
            addWeightInput(material);
        } else {
            removeWeightInput(material);
        }

        // Show/hide weight inputs container
        const hasSelected = document.querySelectorAll('.category-item.selected').length > 0;
        document.getElementById('weight-inputs').style.display = hasSelected ? 'block' : 'none';
    }

    function addWeightInput(material) {
        const container = document.getElementById('weight-inputs');
        const materialNames = {
            paper: 'Paper & Cardboard',
            plastic: 'Plastics',
            glass: 'Glass',
            metal: 'Metals',
            electronics: 'Electronics'
        };

        const inputId = `${material}-weight`;
        if (!document.getElementById(inputId)) {
            const div = document.createElement('div');
            div.className = 'form-group';
            div.innerHTML = `
                <label for="${inputId}" class="form-label">${materialNames[material]} Weight (kg)</label>
                <input type="number" id="${inputId}" class="form-control" placeholder="Estimated weight" min="0" step="0.1" required>
            `;
            container.appendChild(div);
        }
    }

    function removeWeightInput(material) {
        const input = document.getElementById(`${material}-weight`);
        if (input && input.parentElement) {
            input.parentElement.remove();
        }
    }

    function submitPickupRequest() {
        const date = document.getElementById('pickup-date').value;
        const time = document.getElementById('pickup-time').value;
        const notes = document.getElementById('special-notes').value;

        // Validation
        if (!date) {
            alert('Please select a pickup date');
            return;
        }

        if (!time) {
            alert('Please select a time slot');
            return;
        }

        // Get selected materials
        const selectedMaterials = [];
        const weightInputs = document.querySelectorAll('#weight-inputs input');
        const weights = {};

        weightInputs.forEach(input => {
            const material = input.id.replace('-weight', '');
            if (input.value && parseFloat(input.value) > 0) {
                selectedMaterials.push(material);
                weights[material] = parseFloat(input.value);
            }
        });

        if (selectedMaterials.length === 0) {
            alert('Please select at least one material and enter weights');
            return;
        }

        // Create new pickup request
        const newPickup = {
            id: appState.sampleData.pickups.length + 1,
            userId: appState.currentUser.id,
            date: date,
            time: time,
            materials: selectedMaterials,
            weights: weights,
            notes: notes,
            status: 'pending',
            collector: null,
            createdAt: new Date().toISOString()
        };

        // Add to sample data
        appState.sampleData.pickups.push(newPickup);

        // Save to localStorage (simulating database)
        localStorage.setItem('recycleHubPickups', JSON.stringify(appState.sampleData.pickups));

        // Show success and redirect
        alert('Pickup request submitted successfully!');
        window.location.href = 'user-dashboard.html';
    }
    </script>
</body>
</html>